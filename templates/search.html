{% extends "base.html" %}

{% block title %}Search | JoshAtticus Blog{% endblock %}

{% block content %}
    <div class="breadcrumb">
      <a href="/">Home</a> > Search
    </div>

    <h2>Search</h2>

    <div class="search-container">
      <div class="search-input-container">
        <input type="text" id="search-input" class="search-input" placeholder="Search posts..." value="{{ query }}"
          autofocus>
        <div id="loading-indicator" class="loading-indicator" style="display: none;">Searching...</div>
      </div>

      <div id="search-results" class="search-results">
        {% if query %}
        {% if results %}
        <h3>Found {{ total_results }} result{{ 's' if total_results != 1 else '' }}</h3>
        {% for post in results %}
        <article class="post-preview">
          <h2><a href="/posts/{{ post.slug }}">{{ post.title }}</a></h2>
          <div class="date">{{ post.date }}</div>
          <div class="post-content">
            <div class="summary">
              {{ post.summary }}
              {% if post.tags %}
              <div class="tags">
                {% for tag in post.tags %}
                <a href="/tags/{{ tag|lower|replace(' ', '-') }}" class="tag">{{ tag }}</a>
                {% endfor %}
              </div>
              {% endif %}
            </div>
            <div class="post-image">
              <img src="/{{ post.image }}" alt="{{ post.title }} featured image">
            </div>
          </div>
        </article>
        {% endfor %}

        {% if total_pages > 1 %}
        <div class="pagination">
          {% if page > 1 %}
          <a href="/search?q={{ query }}&page={{ page - 1 }}" class="pagination-btn">← Previous</a>
          {% else %}
          <span class="pagination-btn disabled">← Previous</span>
          {% endif %}

          <div class="pagination-numbers">
            {% for p in range(1, total_pages + 1) %}
            {% if p == page %}
            <span class="pagination-number active">{{ p }}</span>
            {% elif p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %} <a
              href="/search?q={{ query }}&page={{ p }}" class="pagination-number">{{ p }}</a>
              {% elif p == page - 3 or p == page + 3 %}
              <span class="pagination-ellipsis">...</span>
              {% endif %}
              {% endfor %}
          </div>

          {% if page < total_pages %} <a href="/search?q={{ query }}&page={{ page + 1 }}" class="pagination-btn">Next
            →</a>
            {% else %}
            <span class="pagination-btn disabled">Next →</span>
            {% endif %}
        </div>
        {% endif %}
        {% else %}
        <p class="no-results">No results found for "{{ query }}".</p>
        {% endif %}
        {% else %}
        <p class="no-results">Enter a search term above.</p>
        {% endif %}
      </div>
    </div>
{% endblock %}

{% block scripts %}
<script src="/static/js/search.js"></script>
{% endblock %}