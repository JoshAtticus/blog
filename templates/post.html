{% extends "base.html" %}

{% block title %}{{ post.title }} | JoshAtticus Blog{% endblock %}

{% block meta %}
  <!-- Open Graph / Facebook Meta Tags -->
  <meta property="og:type" content="article">
  <meta property="og:url" content="{{ url }}">
  <meta property="og:title" content="{{ post.title }} | JoshAtticus Blog">
  <meta property="og:description" content="{{ post.summary }}">
  <meta property="og:image" content="{{ absolute_image_url }}">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ post.title }} | JoshAtticus Blog">
  <meta name="twitter:description" content="{{ post.summary }}">
  <meta name="twitter:image" content="{{ absolute_image_url }}">
{% endblock %}

{% block head_scripts %}
  <script defer src="/static/js/post.js"></script>
  <script>window.wasteofLink = "{{ post.wasteof_link }}";</script>
{% endblock %}

{% block content %}
    <article>
      <div class="post-header">
        <img alt="{{ post.title }}" src="/{{ post.image }}" />
        <div class="title-overlay">
          <h1>{{ post.title }}</h1>
          <div class="post-meta">
            <span class="date">{{ post.date }}</span>
            <span class="view-counter">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="view-icon">
                <path
                  d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
              </svg>
              {{ view_count }} views
            </span>
            <span class="share-counter">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="share-icon">
                <path
                  d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z" />
              </svg>
              {{ shares_count }} shares
            </span>
          </div>
        </div>
      </div>

      <div class="post-container">
        <div class="content">
          {{ post.content|safe }}

          {% if post.tags %}
          <div class="tags" style="margin-top: 1.5rem;">
            {% for tag in post.tags %}
            <a href="/tags/{{ tag|lower|replace(' ', '-') }}" class="tag">{{ tag }}</a>
            {% endfor %}
          </div>
          {% endif %}
        </div>

        <div class="share-buttons">
          <a href="https://twitter.com/intent/tweet?text={{ post.title }} by JoshAtticus&url={{ url }}" target="_blank"
            rel="noopener noreferrer" class="share-twitter">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z">
              </path>
            </svg>
            Post on X
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u={{ url }}&quote={{ post.title }} by JoshAtticus"
            target="_blank" rel="noopener noreferrer" class="share-facebook">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z">
              </path>
            </svg>
            Share on Facebook
          </a>
          <a href="mailto:?subject={{ post.title }}&body=Check out this blog post by JoshAtticus: {{ url }}"
            class="share-email">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z">
              </path>
            </svg>
            Share via Email
          </a>
        </div>

        <div class="comments">
          <h2>Comments</h2>
          <div id="signin-banner" class="signin-banner" style="display: none;">
            <p>Sign in to leave a comment</p>
            <div class="auth-buttons" style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
              <a href="/login" class="signin-btn" style="background-color: #1a73e8; text-decoration: none;">Sign In</a>
            </div>
          </div>
          {% if current_user and current_user.is_banned %}
              <p style="color: #ff5252; text-align: center; padding: 1rem; background: rgba(255, 82, 82, 0.1); border-radius: 6px;">
                  You have been banned from commenting.
              </p>
          {% else %}
          <div id="comment-form" style="display: none;">
            <div class="comment-form-header">
              <div class="user-info" id="user-info"></div>
              <div id="reply-indicator" style="display: none; margin-left: auto; font-size: 0.9rem; color: #888;">
                Replying to <span id="reply-to-name"></span>
                <button id="cancel-reply"
                  style="background: none; border: none; color: #1a73e8; cursor: pointer; margin-left: 5px;">Cancel</button>
              </div>
            </div>
            <textarea id="comment-text" placeholder="Leave a comment..." maxlength="1500" rows="4" required></textarea>
            <div class="comment-form-footer">
              <span class="char-count" id="char-count">0 / 1500</span>
              <button id="submit-comment" class="submit-comment-btn">Post Comment</button>
            </div>
            <div id="comment-status"></div>
          </div>
          {% endif %}
          <div id="comments-list"></div>
        </div>
      </div>
    </article>

  <div id="lightbox" aria-hidden="true" role="dialog">
    <div class="lightbox-inner">
      <button class="lightbox-close" aria-label="Close">×</button>
      <button class="lightbox-nav lightbox-prev" aria-label="Previous">‹</button>
      <img class="lightbox-image" alt="" />
      <button class="lightbox-nav lightbox-next" aria-label="Next">›</button>
      <div class="lightbox-caption"></div>
    </div>
  </div>
{% endblock %}
