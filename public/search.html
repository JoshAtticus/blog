<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Search | JoshAtticus Blog</title>
  <link rel="stylesheet" href="style.css">
  <script defer data-domain="joshatticus.site" src="https://plausible.joshatticus.site/js/script.file-downloads.outbound-links.js"></script>
</head>
<body>
  <div class="reading-progress-container">
    <div class="reading-progress" id="reading-progress"></div>
  </div>

  
<header>
        <h1><a href="index.html">JoshAtticus Blog</a></h1>

    <nav class="nav">
      <a href="tags.html">
        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 2v6h6V2H3zm2 2h2v2H5V4zm8-2v6h6V2h-6zm2 2h2v2h-2V4zM3 12v6h6v-6H3zm2 2h2v2H5v-2zm13-2a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1h-4zm0 2h4v2h-4v-2z"/></svg>
        Tags
      </a>
      <a href="search.html">
        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10 4a6 6 0 1 0 0 12 6 6 0 0 0 0-12zm-8 6a8 8 0 1 1 14.32 4.906l5.387 5.387a1 1 0 0 1-1.414 1.414l-5.387-5.387A8 8 0 0 1 2 10z"/></svg>
        Search
      </a>
    </nav>
  </header>
  
  <main>
    <div class="breadcrumb">
      <a href="index.html">Home</a> > Search
    </div>
    
    <h2>Search</h2>
    
    <div class="search-container">
      <input type="text" id="search-input" class="search-input" placeholder="Search posts..." autofocus>
      
      <div id="search-results" class="search-results">
        <p class="no-results">Start typing to search...</p>
      </div>
    </div>
  </main>
  <footer>Â© 2025 JoshAtticus</footer>
  
  <script>
    // Reading progress tracker
    window.addEventListener('scroll', () => {
      const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
      const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (scrollTop / scrollHeight) * 100;
      document.getElementById('reading-progress').style.width = scrolled + '%';
    });
    
    // Search functionality
    (async function() {
      const searchInput = document.getElementById('search-input');
      const searchResults = document.getElementById('search-results');
      
      // Load search index
      let searchData = [];
      
      try {
        const response = await fetch('search-index.json');
        searchData = await response.json();
      } catch (error) {
        console.error('Error loading search index:', error);
        searchResults.innerHTML = '<p class="no-results">Error loading search data.</p>';
        return;
      }
      
      // Search function
      function search(query) {
        if (!query) {
          searchResults.innerHTML = '<p class="no-results">Start typing to search...</p>';
          return;
        }
        
        // Convert query to lowercase for case-insensitive search
        query = query.toLowerCase();
        
        // Filter posts that match the query
        const results = searchData.filter(post => {
          const titleMatch = post.title.toLowerCase().includes(query);
          const summaryMatch = post.summary.toLowerCase().includes(query);
          const tagMatch = post.tags.some(tag => tag.toLowerCase().includes(query));
          
          return titleMatch || summaryMatch || tagMatch;
        });
        
        // Display results
        if (results.length === 0) {
          searchResults.innerHTML = '<p class="no-results">No results found.</p>';
          return;
        }
        
        // Function to highlight matching text - FIXED by adding extra backslashes
        function highlightText(text, query) {
          if (!text) return '';
          // Escape special regex characters in the query
          const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
          const regex = new RegExp(`(${escapedQuery})`, 'gi');
          return text.replace(regex, '<span class="highlight">$1</span>');
        }
        
        // Generate HTML for results
        let resultsHTML = '';
        
        results.forEach(post => {
          // Highlight matching text
          const highlightedTitle = highlightText(post.title, query);
          const highlightedSummary = highlightText(post.summary, query);
          
          // Generate tags HTML
          let tagsHTML = '';
          if (post.tags && post.tags.length > 0) {
            tagsHTML = '<div class="tags">';
            post.tags.forEach(tag => {
              const tagSlug = tag.toLowerCase().replace(/ /g, '-');
              const highlightedTag = highlightText(tag, query);
              tagsHTML += `<a href="tags/${tagSlug}.html" class="tag">${highlightedTag}</a>`;
            });
            tagsHTML += '</div>';
          }
          
          // Generate image HTML
          let imageHTML = '';
          if (post.image) {
            imageHTML = `<div class="post-image"><img src="${post.image}" alt="${post.title} featured image"></div>`;
          }
          
          resultsHTML += `
            <article class="post-preview">
              <h2><a href="posts/${post.filename}">${highlightedTitle}</a></h2>
              <div class="date">${post.date}</div>
              <div class="post-content">
                <div class="summary">
                  ${highlightedSummary}
                  ${tagsHTML}
                </div>
                ${imageHTML}
              </div>
            </article>
          `;
        });
        
        searchResults.innerHTML = resultsHTML;
      }
      
      // Listen for input changes
      let debounceTimeout;
      searchInput.addEventListener('input', () => {
        clearTimeout(debounceTimeout);
        debounceTimeout = setTimeout(() => {
          search(searchInput.value.trim());
        }, 300); // Debounce to avoid searching on every keystroke
      });
      
      // Check if URL has search parameter
      const urlParams = new URLSearchParams(window.location.search);
      const queryParam = urlParams.get('q');
      if (queryParam) {
        searchInput.value = queryParam;
        search(queryParam);
      }
    })();
  </script>
</body>
</html>